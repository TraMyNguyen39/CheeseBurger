@page
@model ManageAccountModel
@{
	ViewData["Title"] = "ManageAccount";
}
<link rel="stylesheet" href="~/css/manage-account.css" asp-append-version="true" />

<div class="whole__information d-flex align-items-center">
	<div class="main__information">
		<p class="account__information-label">Chi tiết tài khoản</p>
		<div class="account__information-details d-flex">
			<div class="account__information-key col-3">
				<p>Họ và tên:</p>
				<p>Chức vụ:</p>		
				<p>Giới tính:</p>
				<p>Địa chỉ email:</p>
				<p>Số điện thoại:</p>
				<p>Địa chỉ:</p>
			</div>
			<div class="blank_area col-2"></div>
			<div class="account__information-value col-7">
				<p>@Model.staff.StaName</p>
				<p>@Model.staff.StaRoleName</p>
				<p>@(Model.staff.StaGender ? "Nam" : "Nữ")</p>
				<p>@Model.staff.StaEmail</p>
				<p>@Model.staff.StaPhone</p>
				<p>@Model.address</p>
			</div>
		</div>
		<div class="d-flex">
			<button class="submit-btn btn-change-account" type="submit" data-id="@Model.staff.StaID">CẬP NHẬT THÔNG TIN TÀI KHOẢN</button>
			<a asp-page="/admin/changepasswordadmin" class="submit-btn">ĐỔI MẬT KHẨU</a>
		</div>
	</div>
</div>

<!-- Update Account -->
<form method="post" asp-page="ManageAccount" asp-page-handler="Update">
	<div class="modal__customer-update">
		<div class="modal__customer-information">
			<div class="button__exit">
				<span class="exit__surround">
					<i class="fas fa-times"></i>
				</span>
			</div>
			<div class="modal__customer-details">
				<div class="modal__customer-label d-flex align-items-center">
					<p class="modal__label-cate">Cập nhật tài khoản</p>
					<p class="modal__label-main" id="name"></p>
				</div>
				<div class="item-line">
					<p class="label">Họ và tên</p>
					<input class="form-control mr-sm-2" type="search" aria-label="Search" name="Name" required="required">
				</div>
				<div class="item-line">
					<p class="label">Chức vụ</p>
					<input class="form-control mr-sm-2" type="search" aria-label="Search" name="Role" readonly="readonly">
				</div>
				<div class="item-line">
					<p class="label">Địa chỉ Email</p>
					<input class="form-control mr-sm-2" type="search" aria-label="Search" name="Email" required="required">
				</div>
				<div class="item-line d-flex justify-content-between">
					<div class="item-col col-6">
						<p class="label">Số điện thoại</p>
						<input class="form-control mr-sm-2" type="search" aria-label="Search" name="Phone" required="required">
					</div>
					<div class="item-col col-6">
						<p class="label">Giới tính</p>
						<div class="form-control">
							<form method="post">
								<select name="combobox_Item_Gender">
									<option value="Nam">Nam</option>
									<option value="Nữ">Nữ</option>
								</select>
							</form>
						</div>
					</div>
				</div>
				<div class="item-line d-flex justify-content-between">
					<div class="item-col col-6">
						<label class="control-label">Tỉnh(thành phố): </label>
						<input class="form-control mr-sm-2" type="search" value="Đà Nẵng" readonly="readonly">
					</div>
					<div class="item-col col-6">
						<label class="control-label">Quận(huyện): </label>
						<div class="form-control">
							<form method="post">
								<select name="combobox_Item_District" required="required" id="district">									
									@foreach (var i in Model.List_Districts)
									{
										<option value="@i.DistrictName" data-id_district="@i.DistrictID">@i.DistrictName</option>
									}
								</select>
							</form>
						</div>
					</div>
				</div>
				<div class="item-line d-flex justify-content-between">
					<div class="item-col col-6">
						<p class="label">Phường(Xã)</p>
						<div class="form-control">
							<form method="post">
								<select name="combobox_Item_Ward" required="required" id="ward">
									@foreach (var i in Model.List_Wards)
									{
										<option value="@i.WardName" data-district="@i.DistrictID">@i.WardName</option>
									}
								</select>
							</form>
						</div>
					</div>
					<div class="item-col col-6">
						<p class="label">Số nhà</p>
						<input class="form-control mr-sm-2" type="search" aria-label="Search" name="HouseNum" required="required">
					</div>
				</div>
				<button class="submit-btn button__save-change" type="submit">LƯU THÔNG TIN TÀI KHOẢN</button>
			</div>
			<input type="hidden" name="StaID" class="modal__staff-id" value="" />
		</div>
	</div>
</form>
<!-- End Update Account -->
<script src="~/js/manage-account.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script type="text/javascript">
	$(document).ready(function () {
		$('.btn-change-account').on('click', function () {
			var id = $(this).data('id');
			$.ajax({
				type: 'GET',
				data: { id: id },
				url: '@Url.Page("ManageAccount", "Find")',
				success: function (result) {
					$('.modal__customer-update #name').text(result.name);
					$('.modal__customer-update input[name="StaID"]').val(result.id);
					$('.modal__customer-update input[name="Name"]').val(result.name);
					$('.modal__customer-update input[name="Email"]').val(result.email);
					$('.modal__customer-update input[name="Phone"]').val(result.phone);;
					$('.modal__customer-update input[name="HouseNum"]').val(result.housenum);
					$('.modal__customer-update input[name="Role"]').val(result.rolnamee);


					$('select[name="combobox_Item_Gender"] option').filter(function () {
						var gd = (result.gender ? "Nam" : "Nữ");
						return $(this).text().trim() === gd;
					}).prop('selected', true);
					$('select[name="combobox_Item_District"] option').filter(function () {						
						return $(this).text().trim() === result.diss;
					}).prop('selected', true);

					var districtID = result.disID; // lấy ID của quận được chọn sẵn từ kết quả trả về của AJAX
					var wardSelect = document.getElementById("ward");

					// Lặp qua các tùy chọn phường trong combobox phường và ẩn đi những tùy chọn không thuộc quận được chọn sẵn
					for (var i = 0; i < wardSelect.options.length; i++) {
						if (wardSelect.options[i].getAttribute("data-district") == districtID) {
							wardSelect.options[i].style.display = "block";
						} else {
							wardSelect.options[i].style.display = "none";
						}
					}

					$('select[name="combobox_Item_Ward"] option').filter(function () {
						return $(this).text().trim() === result.wrdd;
					}).prop('selected', true);
				},
				error: function (xhr, textStatus, errorThrown) {
					alert('Error loading ingredient: ' + errorThrown);
				}
			});
		});
	});
</script>

<script>
	// Lấy ra combobox quận và combobox phường
	var districtSelect = document.getElementById("district");
	var wardSelect = document.getElementById("ward");

	// Lắng nghe sự kiện khi người dùng chọn một quận trong combobox quận
	districtSelect.addEventListener("change", function () {
		// Lấy ra ID của quận được chọn
		var districtID = districtSelect.options[districtSelect.selectedIndex].getAttribute("data-id_district");

		// Lặp qua các tùy chọn phường trong combobox phường và ẩn đi những tùy chọn không thuộc quận được chọn
		for (var i = 0; i < wardSelect.options.length; i++) {
			if (wardSelect.options[i].getAttribute("data-district") == districtID) {
				wardSelect.options[i].style.display = "block";
			} else {
				wardSelect.options[i].style.display = "none";
			}
		}
		// Chọn sẵn phường đầu tiên trong combobox phường
		for (var i = 0; i < wardSelect.options.length; i++) {
			if (wardSelect.options[i].getAttribute("data-district") == districtID) {
				wardSelect.selectedIndex = i;
				break;
			}
		}
	});	
</script>
